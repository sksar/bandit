import{_ as u}from"./preload-helper.101896b7.js";import{q as b,a as C,P as R,A as P,w as M}from"./index.0c99c3d9.js";import{d as V}from"./environment.9aa685ef.js";import{w as m}from"./paths.edd62e39.js";var I;(function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"})(I||(I={}));var S;(function(t){t[t.Sparse=0]="Sparse",t[t.Dense=1]="Dense"})(S||(S={}));var d;(function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"})(d||(d={}));var N;(function(t){t[t.DAY=0]="DAY",t[t.MILLISECOND=1]="MILLISECOND"})(N||(N={}));var w;(function(t){t[t.SECOND=0]="SECOND",t[t.MILLISECOND=1]="MILLISECOND",t[t.MICROSECOND=2]="MICROSECOND",t[t.NANOSECOND=3]="NANOSECOND"})(w||(w={}));var _;(function(t){t[t.YEAR_MONTH=0]="YEAR_MONTH",t[t.DAY_TIME=1]="DAY_TIME",t[t.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(_||(_={}));var O;(function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"})(O||(O={}));var c;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"})(c||(c={}));var h;(function(t){t[t.OFFSET=0]="OFFSET",t[t.DATA=1]="DATA",t[t.VALIDITY=2]="VALIDITY",t[t.TYPE=3]="TYPE"})(h||(h={}));function Y(t){switch(t.typeId){case c.Date:return"date";case c.Float:case c.Int:return"number";case c.Bool:return"boolean";case c.Dictionary:default:return"string"}}function q(t){if(t==null)return[];const a=t.toArray();return Object.defineProperty(a,"_evidenceColumnTypes",{enumerable:!1,value:t.schema.fields.map(i=>({name:i.name,evidenceType:Y(i.type),typeFidelity:"precise"}))}),a}function F(){let t,a,i=new Promise((r,n)=>{t=r,a=n});return{resolve:t,reject:a,promise:i}}function v(t){return Promise.race([t,new Promise((a,i)=>setTimeout(()=>i(new Error("Timeout while initializing database")),5e3))])}let s,l;const{resolve:B,reject:g,promise:U}=F(),{resolve:j,reject:W,promise:$}=F();let A=!1;async function E(){if(!s){if(A)return v(U);A=!0;try{const a=await C().then(n=>n.wasmExceptions)?{mainModule:(await u(()=>import("./duckdb-eh.453bc6d8.js"),[])).default,mainWorker:(await u(()=>import("./duckdb-browser-eh.worker.e2c9c33f.js"),[])).default}:{mainModule:(await u(()=>import("./duckdb-mvp.cf345cf4.js"),[])).default,mainWorker:(await u(()=>import("./duckdb-browser-mvp.worker.31449606.js"),[])).default},i={}.VITE_EVIDENCE_DEBUG?new R:new P,r=new a.mainWorker;s=new M(i,r),await s.instantiate(a.mainModule),await s.open({query:{castBigIntToDouble:!0,castTimestampToDate:!0,castDecimalToDouble:!0,castDurationToTime64:!0}}),l=await s.connect(),B()}catch(t){throw g(t),t}}}async function K(t){s||await E(),await l.query(`PRAGMA search_path='${t.join(",")}'`)}async function D(t){await s.flushFiles();for(const a of await s.globFiles(t))await s.dropFile(a.fileName)}async function X(t,a=!1){s||await E(),a||await D("*"),{}.VITE_EVIDENCE_DEBUG&&console.debug("Updating Parquet URLs");try{for(const i in t){await l.query(`CREATE SCHEMA IF NOT EXISTS "${i}";`);for(const r of t[i]){const n=r.split(/\\|\//).at(-1).slice(0,-8),e=`${i}_${n}.parquet`;let o=r;!r.startsWith("http")&&!r.startsWith("/")&&(o=`/${r}`),o.startsWith("/static")&&(o=o.substring(7)),a&&(await D(e),await D(r)),await s.registerFileURL(e,o,b.HTTP,!1),await l.query(`CREATE OR REPLACE VIEW "${i}"."${n}" AS (SELECT * FROM read_parquet('${e}'));`)}}j()}catch(i){throw W(i),i}}async function H(t){return s||await E(),await v($),await l.query(t).then(q)}function Z(t,...a){return t.call(this,...a)}const T=m(!0),p=m("");function x(){const{subscribe:t,update:a}=m([]),i={},r=n=>{a(e=>e.filter(o=>o.id!==n))};return{subscribe:t,add:(n,e=2e3)=>{if(n.id=Math.random().toString(),a(o=>(o.push(n),o)),e){const o=setTimeout(()=>{r(n.id),delete i[n.id]},e);i[n.id]=o}},dismiss:n=>{r(n),i[n]&&(clearTimeout(i[n]),delete i[n])}}}const y=x(),L=t=>{let a;return t.subscribe(i=>a=i)(),a},z=(t,a)=>{const i=m(JSON.parse(localStorage.getItem(t))??a),{subscribe:r,set:n}=i,e=o=>{typeof o>"u"||o===null?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(o))};return e(L(i)),{subscribe:r,set:o=>{n(o),e(o)},update:o=>{const f=o(L(i));n(f),e(f)}}};z("showQueries",V);export{h as B,N as D,_ as I,I as M,d as P,c as T,S as U,Z as a,w as b,O as c,q as d,E as i,T as p,H as q,p as r,X as s,y as t,K as u};
