import{s as ue,b as le,c as he,e as ae,f as fe,g as ne,Q as Y}from"./index.0c99c3d9.js";import{y as ce}from"./index.5a1822b8.js";import"./stores.84469616.js";const De="customFormattingSettings",Ue="_inputs",X="auto",de=3,oe=(t,r)=>{switch(r){case"T":return t/1e12;case"B":return t/1e9;case"M":return t/1e6;case"k":return t/1e3;default:return t}},me=(t,r=7)=>{let i,s="",l=t==null?void 0:t.median,d;if(l!==void 0){let a;s=ye(l),s?(a=oe(l,s),d=!0):(a=l,d=!1),t.maxDecimals===0&&!d?i="#,##0":i=pe(a,r)}else i="#,##0",d=!1;return{formatCode:X,valueType:"number",_autoFormat:{autoFormatCode:i,truncateUnits:d,columnUnits:s}}};function pe(t,r=7,i=de){let s="#,##0",l=_e(t),d=0;return l-i<0&&(d=Math.min(Math.max(Math.abs(l-i+1),0),r)),d>0&&(s+=".",s+="0".repeat(d)),s}function ye(t){let r=Math.abs(t);return r>=5e12?"T":r>=5e9?"B":r>=5e6?"M":r>=5e3?"k":""}function _e(t){return t===0?0:Math.floor(Math.log10(t))}const be=[{primaryCode:"usd",currencySymbol:"$",displayName:"USD - United States Dollar"},{primaryCode:"aud",currencySymbol:"A$",displayName:"AUD - Australian Dollar",escapeCurrencySymbol:!0},{primaryCode:"brl",currencySymbol:"R$",displayName:"BRL - Brazilian Real",escapeCurrencySymbol:!0},{primaryCode:"cad",currencySymbol:"C$",displayName:"CAD - Canadian Dollar",escapeCurrencySymbol:!0},{primaryCode:"cny",currencySymbol:"¥",displayName:"CNY - Renminbi",escapeCurrencySymbol:!0},{primaryCode:"eur",currencySymbol:"€",displayName:"EUR - Euro"},{primaryCode:"gbp",currencySymbol:"£",displayName:"GBP - Pound Sterling",escapeCurrencySymbol:!0},{primaryCode:"jpy",currencySymbol:"¥",displayName:"JPY - Japanese Yen",escapeCurrencySymbol:!0},{primaryCode:"inr",currencySymbol:"₹",displayName:"INR - Indian Rupee",escapeCurrencySymbol:!0},{primaryCode:"krw",currencySymbol:"₩",displayName:"KRW - South Korean won",escapeCurrencySymbol:!0},{primaryCode:"ngn",currencySymbol:"₦",displayName:"NGN -  Nigerian Naira",escapeCurrencySymbol:!0},{primaryCode:"rub",currencySymbol:"rub",displayName:"RUB - Russian Ruble",escapeCurrencySymbol:!0},{primaryCode:"sek",currencySymbol:"kr",displayName:"SEK - Swedish Krona",escapeCurrencySymbol:!0}],ge=[{derivedSuffix:"",valueFormatCode:"#,##0",exampleInput:412.17,auto:!0},{derivedSuffix:"0",valueFormatCode:"#,##0",exampleInput:7043.123},{derivedSuffix:"1",valueFormatCode:"#,##0.0",exampleInput:7043.123},{derivedSuffix:"2",valueFormatCode:"#,##0.00",exampleInput:7043.123},{derivedSuffix:"0k",valueFormatCode:'#,##0,"k"',exampleInput:64301.12},{derivedSuffix:"1k",valueFormatCode:'#,##0.0,"k"',exampleInput:64301.12},{derivedSuffix:"2k",valueFormatCode:'#,##0.00,"k"',exampleInput:64301.12},{derivedSuffix:"0m",valueFormatCode:'#,##0,,"M"',exampleInput:456430112e-2},{derivedSuffix:"1m",valueFormatCode:'#,##0.0,,"M"',exampleInput:456430112e-2},{derivedSuffix:"2m",valueFormatCode:'#,##0.00,,"M"',exampleInput:456430112e-2},{derivedSuffix:"0b",valueFormatCode:'#,##0,,,"B"',exampleInput:978456430112e-2},{derivedSuffix:"1b",valueFormatCode:'#,##0.0,,,"B"',exampleInput:978456430112e-2},{derivedSuffix:"2b",valueFormatCode:'#,##0.00,,,"B"',exampleInput:978456430112e-2}];be.map(t=>{let r=[];return ge.forEach(i=>{let s={formatTag:t.primaryCode+i.derivedSuffix,parentFormat:t.primaryCode,formatCategory:"currency",valueType:"number",exampleInput:i.exampleInput,titleTagReplacement:` (${t.currencySymbol})`},l=t.escapeCurrencySymbol?`"${t.currencySymbol}"`:t.currencySymbol;i.auto||X===i.formatCode?(s.formatCode=X,s._autoFormat={autoFormatFunction:(d,a,h)=>{let o=me(h,2),u=`${l}${o._autoFormat.autoFormatCode}`,c="",Q=d;return o._autoFormat.truncateUnits&&o._autoFormat.columnUnits?(c=o._autoFormat.columnUnits,Q=oe(d,o._autoFormat.columnUnits)):u.endsWith(".0")&&(u=u+"0"),ue.format(u,Q)+c}}):s.formatCode=`${l}${i.valueFormatCode}`,i.axisValueFormatCode&&(s.axisFormatCode=i.axisValueFormatCode),r.push(s)}),r}).flat();var K=globalThis&&globalThis.__classPrivateFieldGet||function(t,r,i,s){if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?t!==r||!s:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?s:i==="a"?s.call(t):s?s.value:r.get(t)},P;class Se{constructor(){P.set(this,new Set),this.subscribe=r=>(K(this,P,"f").add(r),r(this.value()),()=>K(this,P,"f").delete(r)),this.publish=()=>{const r=this.value();K(this,P,"f").forEach(i=>i(r))}}}P=new WeakMap;const we=t=>{let r=0;for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);r=(r<<5)-r+s,r&=r}return new Uint32Array([r])[0].toString(36)},q=(...t)=>we(JSON.stringify(t)),O=(t,r,i)=>{try{const s=r();return s instanceof Promise?s.then(t).catch(l=>{if(i)return i(l);throw l}):t(s)}catch(s){if(i)return i(s);throw s}},re=t=>Array.isArray(t)?t:[t],Ce=(t,r)=>{if("sum"in r)for(const i of re(r.sum)){const s=typeof i=="object"&&"alias"in i?i.alias:`sum_${i}`;t.select({[s]:le(i)})}if("avg"in r)for(const i of re(r.avg)){const s=typeof i=="object"&&"alias"in i?i.alias:`avg_${i}`;t.select({[s]:he(i)})}return t},Te=(t,r)=>t.$select(r,{rows:ae("*")}).$groupby(r),ve=(t,r)=>{for(const[i,s]of Object.entries(r))s?t.orderby(i):t.orderby(fe(i));return t},Ee=(t,r)=>t.limit(r),Ie=(t,r)=>t.offset(r),Me=(t,r)=>(t.where(ne`${r}`),t),p={agg:{fn:Ce,currentAsInitial:!1},groupBy:{fn:Te,currentAsInitial:!1},orderBy:{fn:ve,currentAsInitial:!0},where:{fn:Me,currentAsInitial:!0},limit:{fn:Ee,currentAsInitial:!0},offset:{fn:Ie,currentAsInitial:!0}};function Ne(t){return t.startsWith("STRUCT")||t.endsWith("[]")}function xe(t){return t.startsWith("DECIMAL")}function Ae(t){switch(t){case"number":return 12;case"boolean":return 4;case"string":return 2*15;case"date":return 48;default:return 0}}function Fe(t){if(Ne(t))return"string";if(xe(t))return"number";switch(t){case"BOOLEAN":return"boolean";case"BIGINT":case"DOUBLE":case"FLOAT":case"INTEGER":case"SMALLINT":case"TINYINT":case"UBIGINT":case"UINTEGER":case"USMALLINT":case"UTINYINT":case"HUGEINT":return"number";case"UUID":case"VARCHAR":return"string";case"DATE":case"TIMESTAMP":case"TIMESTAMP_S":case"TIMESTAMP_MS":case"TIMESTAMP_NS":case"TIMESTAMP WITH TIME ZONE":return"date";case"INTERVAL":case"TIME":case"TIME WITH TIME ZONE":case"BLOB":case"BIT":return"string";default:return console.error(`Column type ${t} is not supported`),"string"}}function Qe(t){let r=t.length*4;for(const{type:i}of t)r+=Ae(i);return r}var e=globalThis&&globalThis.__classPrivateFieldGet||function(t,r,i,s){if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?t!==r||!s:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?s:i==="a"?s.call(t):s?s.value:r.get(t)},n=globalThis&&globalThis.__classPrivateFieldSet||function(t,r,i,s,l){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!l)throw new TypeError("Private accessor was defined without a setter");if(typeof r=="function"?t!==r||!l:!r.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?l.call(t,i):l?l.value=i:r.set(t,i),i},H,J,m,w,f,x,A,T,R,b,y,_,g,v,C,E,L,W,S,F,z,k,I,G,Z,B,D,$,M;class ee extends Se{static isQueryStore(r){return!!(typeof r=="object"&&r&&"__isQueryStore"in r&&r.__isQueryStore===!0)}get proxy(){return e(this,A,"f")}get text(){return e(this,w,"f").toString()}get originalText(){return e(this,T,"f")instanceof Y?e(this,T,"f").toString():e(this,T,"f")instanceof m?e(this,T,"f").text:e(this,T,"f")}get _evidenceColumnTypes(){var r,i;return Array.from((i=(r=e(this,f,"f")._evidenceColumnTypes)!==null&&r!==void 0?r:e(this,R,"f"))!==null&&i!==void 0?i:[])}get columns(){var r,i;return Array.from((i=(r=e(this,f,"f")._evidenceColumnTypes)!==null&&r!==void 0?r:e(this,R,"f"))!==null&&i!==void 0?i:[])}get loaded(){return e(this,_,"f")&&e(this,v,"f")&&e(this,b,"f")}get loading(){return e(this,y,"f")||e(this,g,"f")||e(this,C,"f")}get lengthLoaded(){return e(this,b,"f")}get lengthLoading(){return e(this,y,"f")}get dataLoaded(){return e(this,_,"f")}get dataLoading(){return e(this,g,"f")}get metaLoaded(){return e(this,v,"f")}get metaLoading(){return e(this,C,"f")}get length(){var r;return(r=e(this,E,"f"))!==null&&r!==void 0?r:0}get score(){var r;return(r=e(this,L,"f"))!==null&&r!==void 0?r:0}get error(){if(e(this,S,"f")!==void 0)return e(this,S,"f")instanceof Error?e(this,S,"f"):new Error("Query encountered an error",{cause:e(this,S,"f")})}static create(r,i,s,l={disableCache:!1},d){const a=q(r);if(s||(s=a),!l.disableCache){const o=m.cache.get(a);if(o)return o}const h=new m(r,i,s,l,d);return m.cache.set(a,h),h}constructor(r,i,s,l={disableCache:!1},d){super(),this.opts=l,this.root=d,w.set(this,new Y),f.set(this,[]),this.value=()=>e(this,A,"f"),x.set(this,void 0),this.__isQueryStore=!0,A.set(this,void 0),T.set(this,void 0),R.set(this,[]),b.set(this,!1),y.set(this,!1),_.set(this,!1),g.set(this,!1),v.set(this,!1),C.set(this,!1),E.set(this,void 0),L.set(this,void 0),W.set(this,{}),S.set(this,void 0),F.set(this,a=>{var h;m.debug&&console.debug(`QueryStore ${this.id.substring(0,6)} | QueryStore encountered a non-fatal error`,a instanceof Error&&(h=a==null?void 0:a.message)!==null&&h!==void 0?h:a),n(this,S,a,"f"),a&&(n(this,E,0,"f"),n(this,b,!1,"f"),n(this,y,!1,"f")),this.opts.errorNotifier&&this.opts.errorNotifier(this.error),this.publish()}),z.set(this,()=>{const{initialData:a,initialDataDirty:h,initialError:o}=this.opts;return o?(n(this,S,o,"f"),!1):a&&!e(this,f,"f").length?(n(this,g,!0,"f"),n(this,y,!0,"f"),n(this,C,!0,"f"),n(this,E,0,"f"),this.publish(),O(u=>u.length?(n(this,f,u,"f"),n(this,E,u.length,"f"),n(this,R,e(this,f,"f")._evidenceColumnTypes,"f"),n(this,g,!1,"f"),n(this,y,!1,"f"),n(this,C,!1,"f"),n(this,_,!h,"f"),n(this,b,!h,"f"),n(this,v,!h,"f"),n(this,W,Object.fromEntries(this._evidenceColumnTypes.map(c=>[c.name,null])),"f"),e(this,B,"f").call(this),e(this,D,"f").call(this),this.publish(),h?(e(this,I,"f").call(this),!1):!0):(n(this,y,!1,"f"),n(this,g,!1,"f"),n(this,C,!1,"f"),e(this,I,"f").call(this),!1),()=>a,u=>(e(this,F,"f").call(this,u),!1))):!1}),this.fetch=()=>e(this,I,"f").call(this),k.set(this,void 0),I.set(this,()=>{if(e(this,g,"f")||e(this,_,"f"))return e(this,k,"f");if(e(this,S,"f"))return m.debug&&console.debug(`QueryStore ${this.id.substring(0,6)} | Refusing to execute data query; store has an error state.`),e(this,k,"f");n(this,g,!0,"f"),this.publish();const a=`--data
${e(this,w,"f").toString()}`;return n(this,k,O(h=>(n(this,f,h,"f"),n(this,g,!1,"f"),n(this,_,!0,"f"),e(this,G,"f").call(this)),()=>e(this,x,"f").call(this,a,this.id),e(this,F,"f")),"f"),e(this,k,"f")}),G.set(this,()=>{if(e(this,y,"f")||e(this,b,"f"))return;if(e(this,S,"f")){m.debug&&console.debug(`QueryStore ${this.id.substring(0,6)} | Refusing to execute length query; store has an error state.`);return}if(!e(this,f,"f").length&&e(this,_,"f")){n(this,E,e(this,f,"f").length,"f"),n(this,b,!0,"f"),e(this,B,"f").call(this),e(this,D,"f").call(this),this.publish();return}n(this,y,!0,"f"),this.publish();const h=`--len
${new Y().with({original:e(this,w,"f")}).select({length:ae("*")}).from("original")}`;return O(o=>{const[u]=o;n(this,E,u.length,"f"),n(this,b,!0,"f"),n(this,y,!1,"f"),e(this,B,"f").call(this),e(this,D,"f").call(this),this.publish()},()=>e(this,x,"f").call(this,h,`${this.id}_length`),e(this,F,"f"))}),Z.set(this,()=>{if(e(this,S,"f")){m.debug&&console.debug(`QueryStore ${this.id.substring(0,6)} | Refusing to execute metadata query; store has an error state.`);return}if(!e(this,v,"f"))return n(this,C,!0,"f"),this.publish(),O(a=>{n(this,R,a.map(h=>({name:h.column_name,evidenceType:Fe(h.column_type),typeFidelity:"precise"})),"f"),n(this,W,Object.fromEntries(this._evidenceColumnTypes.map(h=>[h.name,null])),"f"),this._evidenceColumnTypes.length>0&&(n(this,C,!1,"f"),n(this,v,!0,"f"),e(this,B,"f").call(this),e(this,D,"f").call(this)),this.publish()},()=>e(this,x,"f").call(this,`--col-metadata
DESCRIBE ${e(this,w,"f").toString()}`,`${this.id}_metadata`),e(this,F,"f"))}),B.set(this,()=>{const a=Qe(this._evidenceColumnTypes);n(this,L,a*this.length,"f")}),D.set(this,()=>{this.opts.scoreNotifier&&(this.score<10*1024*1024||this.opts.scoreNotifier({id:this.id,query:e(this,w,"f").toString(),score:this.score}))}),$.set(this,[]),M.set(this,(a,h,o=!1)=>(...u)=>{var c,Q;const te=h(e(this,w,"f").clone(),...u),N=q(te.toString()),U=(c=this.root)!==null&&c!==void 0?c:this;if(!this.opts.disableCache&&m.cache.has(N)){const V=m.cache.get(N);if(!V)throw new Error("Error getting query from cache. This should not occur.");return e(U,$,"f").includes(N)||(V.subscribe(U.publish),e(U,$,"f").push(N)),e(V,A,"f")}const j=new m(te,e(this,x,"f"),N,Object.assign(Object.assign({},this.opts),{initialData:o?e(this,f,"f"):void 0,initialDataDirty:!0}),(Q=this.root)!==null&&Q!==void 0?Q:this);return e(U,$,"f").push(N),j.subscribe(U.publish),m.cache.set(N,j),e(j,A,"f")}),this.where=e(this,M,"f").call(this,"where",p.where.fn,p.where.currentAsInitial),this.groupBy=e(this,M,"f").call(this,"groupBy",p.groupBy.fn,p.groupBy.currentAsInitial),this.agg=e(this,M,"f").call(this,"agg",p.agg.fn,p.agg.currentAsInitial),this.orderBy=e(this,M,"f").call(this,"orderBy",p.orderBy.fn,p.orderBy.currentAsInitial),this.limit=e(this,M,"f").call(this,"limit",p.limit.fn,p.limit.currentAsInitial),this.offset=e(this,M,"f").call(this,"offset",p.offset.fn,p.offset.currentAsInitial),Object.freeze(l),this.hash=q(r),this.id=s??this.hash,n(this,T,r,"f"),typeof r=="string"?e(this,w,"f").from({__userQuery:ne`(${r})`}).select("*"):n(this,w,r,"f"),n(this,x,(...a)=>i(a[0],a[1]),"f"),n(this,A,new Proxy(this,{get:(a,h)=>{let o=h;if(typeof o=="string"&&/^[\d.]+$/.exec(o)&&(o=parseInt(o)),typeof o=="number"){if(!e(a,_,"f"))try{const u=e(a,I,"f").call(a);u instanceof Promise&&u.catch(c=>{throw new Error("Failed to update query store",{cause:c})})}catch(u){throw new Error("Failed to update query store",{cause:u})}return e(a,f,"f")[o]?e(a,f,"f")[o]:e(a,W,"f")}if(o==="at"){if(!e(a,_,"f"))try{const u=e(a,I,"f").call(a);u instanceof Promise&&u.catch(c=>{throw new Error("Failed to update query store",{cause:c})})}catch(u){throw new Error("Failed to update query store",{cause:u})}return u=>{var c;return e(this,_,"f")?e(this,f,"f").at(u):(c=e(this,f,"f").at(u))!==null&&c!==void 0?c:e(this,W,"f")}}else if(o==="length"&&!e(a,b,"f"))try{const u=e(a,G,"f").call(a);u instanceof Promise&&u.catch(c=>{throw new Error("Failed to update query store length",{cause:c})})}catch(u){throw new Error("Failed to update query store length",{cause:u})}return o in a?typeof a[o]=="function"?a[o].bind(a):a[o]:typeof e(a,f,"f")[o]=="function"?e(a,f,"f")[o].bind(e(a,f,"f")):e(a,f,"f")[o]}}),"f"),l.noResolve?(n(this,g,!0,"f"),n(this,C,!0,"f"),n(this,y,!0,"f"),n(this,_,!1,"f"),n(this,v,!1,"f"),n(this,b,!1,"f"),this.publish()):(O(a=>{a||e(this,Z,"f").call(this)},()=>e(this,z,"f").call(this),e(this,F,"f")),typeof window>"u"&&!this.loaded&&e(this,I,"f").call(this))}static emptyCache(){m.cache.clear()}}m=ee,w=new WeakMap,f=new WeakMap,x=new WeakMap,A=new WeakMap,T=new WeakMap,R=new WeakMap,b=new WeakMap,y=new WeakMap,_=new WeakMap,g=new WeakMap,v=new WeakMap,C=new WeakMap,E=new WeakMap,L=new WeakMap,W=new WeakMap,S=new WeakMap,F=new WeakMap,z=new WeakMap,k=new WeakMap,I=new WeakMap,G=new WeakMap,Z=new WeakMap,B=new WeakMap,D=new WeakMap,$=new WeakMap,M=new WeakMap;ee.debug=!!(typeof window>"u"?{}.VITE_EVIDENCE_DEBUG:!((J=(H=import.meta)===null||H===void 0?void 0:H.env)===null||J===void 0)&&J.VITE_EVIDENCE_DEBUG);ee.cache=new Map;var ie;(function(t){t.BOOLEAN="boolean",t.NUMBER="number",t.STRING="string",t.DATE="date"})(ie||(ie={}));var se;(function(t){t.INFERRED="inferred",t.PRECISE="precise"})(se||(se={}));const Re="___usql_query",Oe=t=>{ce(Re,t)};export{De as C,Ue as I,ee as Q,Oe as s};
